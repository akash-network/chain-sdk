#!/usr/bin/env -S node --experimental-strip-types --no-warnings

import { validator } from '@exodus/schemasafe'
import fs from "node:fs";

import jwtSchema from "../../specs/jwt-schema.json" with { type: "json" };

const validate = validator(jwtSchema as any, {
  allErrors: true,
  includeErrors: true,
});

fs.writeFileSync(`${import.meta.dirname}/../src/sdk/provider/auth/jwt/validate-payload.ts`,
  `// DO NOT EDIT THIS FILE\n` +
  `// This file is generated by the script/compile-json-schema-to-ts.ts script\n` +
  `// It is used to validate the JWT schema\n\n` +
  `// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n` +
  `// @ts-nocheck\n\n` +
  `export const schema = ${JSON.stringify(jwtSchema, null, 2)};\n` +
  `export const validate = ${validate.toModule()};\n`
);
